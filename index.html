<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Welcome to LemmaCraft | Math Proof Game</title>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

        <style type="text/tailwindcss">
                
                @theme {
                        --color-soft-white: #f5f5f5;
                        --color-teal: #26A69A;
                        --color-light-gray: #B0BEC5;
                        --color-bright-yellow: #FFCA28;
                        --color-dark-gray: #37474F;
                }

        </style>
</head>
<body class="bg-soft-white relative w-full">
        <img src="./imgs/wizardHat.svg" class="h-full block text-center mx-auto w-auto pt-16 " id="hat-svg">
        <h1 class="text-7xl font-bold mb-2 text-center pt-4 mb-10">LemmaCraft</h1>


        <div class="absolute mx-auto bg-soft-white w-full min-h-full text-lg" id="mode-selector">
                <p class="text-left mb-6 max-w-xl mx-auto">Welcome!</p>
                <p class="text-left mb-6 max-w-xl mx-auto">LemmaCraft is a math proof game where you prove simple lemmas on every level. There are two modes to play the game in. </p>
                <p class="text-left mb-6 max-w-xl mx-auto">In <strong>Story Mode</strong>, you'll follow Simon, a young wizard apprentice who finds himself responsible for the fate of the free world. This story follows his hunt for a goblin army that pillaged his village, taking with them a spell-book powerful enough to overwhelm the free world. Perfect for anyone who loves a cozy fantasy adventure.</p>
                <p class="text-left mb-8 max-w-xl mx-auto"><strong>Just Here for the Math</strong> focuses exclusively on the engaging math proofs you must solve on the adventure. A standalone game perfect for anyone motivated by the thrill of problem solving who doesn't care for the fantastical adventures in Story Mode.</p>
                <p class="text-center max-w-xl mx-auto underline underline-offset-2 font-bold">Choose your mode:</p>
                <p class="text-center mb-8 max-w-xl mx-auto">You can change your mind later</p>
                <div class="flex gap-x-6 justify-center mb-32">
                        <button class="block bg-gray-200 rounded-xl border-2 border-gray-300 shadow w-80 min-h-60 z-20 hover:-translate-y-2 cursor-pointer group transition duration-300 hover:bg-gray-400 hover:border-gray-600" onclick="setMode('story')">
                                <img src="./imgs/story-image.png" alt="" class="rounded-t-lg group-hover:brightness-50 transition duration-300">
                                <span class="block py-2">Story Mode</span>
                        </button>
                        <button class="block bg-gray-200 rounded-xl border-2 border-gray-300 shadow w-80 min-h-60 z-20 hover:-translate-y-2 cursor-pointer group transition duration-300 hover:bg-gray-400 hover:border-gray-600" onclick="setMode('math')">
                                <img src="./imgs/math-image-2.png" alt="" class="rounded-t-lg group-hover:brightness-50 transition duration-300">
                                <span class="block py-2">Just Here for the Math</span>
                        </button>
                </div>
        </div>

        <div class="flex w-4xl mx-auto px-4 justify-between mb-4">
                <a class="flex py-3 mb-2 rounded-full cursor-pointer gap-x-4 group bg-gray-200 pl-8 pr-8 hover:pr-16 py-6 hover:bg-gray-300" id="next-level-link" href="#">
                        <div>
                                <p class="font-bold underline text-xl">Up Next:</p>
                                <p class="block text-xl">Level <span id="next-level-world">3</span>-<span id="next-level-index">5</span>: <span id="next-level-name">Level Name</span></p>
                        </div>
                        <button class="block bg-light-gray px-6 rounded-full group-hover:bg-gray-400 group-hover:ml-8 group-hover:translate-x-8 transition cursor-pointer">
                                →
                        </button>
                </a>
                <button class="block bg-light-gray px-6 py-3 rounded-full cursor-pointer hover:bg-gray-400 transition block h-min mt-auto" onclick="changeMode()">Mode</button>
        </div>
        <div class="grid grid-cols-4 gap-x-4 px-4 pb-8 max-w-4xl mx-auto items-stretch" id="level-grid">
                <!-- Javascript injects HTML here -->
        </div>
        <p class="text-center mb-4">Made by Matthew McWilliams. Report bugs or get in contact
                <a href="./contact.html" class="text-blue-800 underline">here</a>. Or see more of my cool stuff 
                <a href="/" class="text-blue-800 underline">here</a>.</p>

        <script type="module">
                import { chapters } from "./worlds.js";

                window.setMode = function(mode) {



                        window.localStorage.setItem('gamemode', mode)

                        document.getElementById('mode-selector').classList.add('hidden')

                        const hatSvgEl = document.getElementById('hat-svg')
                        hatSvgEl.scrollIntoView({ behavior: 'auto', block: 'start' })
                        
                        const levelGridEl = document.getElementById('level-grid')
                        let currentlyUp = true

                        let nextLevelName = undefined
                        let nextLevelIndex = undefined
                        let nextLevelWorld = undefined
                        let nextLevelLink = undefined

                        chapters.forEach((world, worldIndex) => {
                                
                                const levelComplete = world.levels.every((level, levelIndex) => localStorage.getItem(`${worldIndex+1}-${levelIndex+1}`) === 'complete')
                                
                                const worldEl = document.createElement('div')
                                
                                const linkBlockEl = document.createElement('a')
                                linkBlockEl.href = `${world.path}level-1-${world.levels[0].urlName}.html`
                                linkBlockEl.classList.add("block", levelComplete ? "bg-teal" : (currentlyUp ? "bg-teal" : "bg-light-gray"), "text-center", "py-12" ,"rounded-xl", "hover:-translate-y-2", 'h-full')
                                linkBlockEl.innerHTML = `
                                <strong>Chapter ${worldIndex+1}</strong>
                                <p class="px-6">${mode == 'story' ? world.name : world.mathName}</p>
                                `
                                worldEl.append(linkBlockEl)
                                levelGridEl.appendChild(worldEl)

                                
                                const levelListEl = document.createElement('ol')
                                levelListEl.classList.add('list-decimal', 'ml-10', 'mt-4', 'row-start-2')
                                world.levels.forEach((level, levelIndex) => {
                                        const levelComplete = localStorage.getItem(`${worldIndex+1}-${levelIndex+1}`) === 'complete'
                                        
                                        const link = `${world.path}level-${levelIndex+1}-${mode == 'story' ? world.levels[levelIndex].urlName : world.levels[levelIndex].lemmaName.replaceAll('_', '-')}.html`

                                        const displayName = (mode == 'story' ? level.name : level.lemmaName)
                                        
                                        if (!levelComplete && nextLevelName == undefined) {
                                                nextLevelWorld = worldIndex + 1
                                                nextLevelIndex = levelIndex + 1
                                                nextLevelName = displayName
                                                nextLevelLink = link
                                        }
                                        
                                        const liEl = document.createElement('li')
                                        liEl.classList.add('mb-2', 'pl-3')
                                        
                                        const aEl = document.createElement('a')
                                        aEl.href = link
                                        aEl.innerText = (levelComplete ? '✅  ' : '') + displayName
                                        aEl.classList.add('underline')
                                        
                                        liEl.append(aEl)
                                        levelListEl.append(liEl)
                                })
                                levelGridEl.appendChild(levelListEl)
                                        
                                currentlyUp &=levelComplete
                        })

                        document.getElementById('next-level-world').innerText = nextLevelWorld
                        document.getElementById('next-level-index').innerText = nextLevelIndex
                        document.getElementById('next-level-name').innerText = nextLevelName
                        document.getElementById('next-level-link').href = nextLevelLink
                }

                window.changeMode = function() {
                        window.localStorage.removeItem('gamemode')
                        window.location.reload()
                }

                const gamemode = window.localStorage.getItem('gamemode')
                if (gamemode == 'story' || gamemode == 'math') {
                        window.setMode(gamemode)
                }
                
        </script>
</body>
</html>